# Sample JSON data
origina_data = [
  {
    "account_name": "DRM2",
    "amount_spent": 94255.04,
    "ad_id": 120211217914390770,
    "persona_attributes": "[{\"persona_attribute\":\"Female\"},{\"persona_attribute\":\"Over 40\"},{\"persona_attribute\":\"Busy\"},{\"persona_attribute\":\"Seeks convenience\"},{\"persona_attribute\":\"Values natural beauty\"}]",
    "hook_types": "[{\"hook_type_explanation\":\"The hook presents a common problem (concealer making eyes look older) and promises a solution.\",\"hook_type_name\":\"Problem/Solution\"}]",
    "hook_visual_elements": "[{\"hook_visual_element_explanation\":\"Animation showing concealer application and its negative effect on the eyes.\",\"hook_visual_element_name\":\"3D Animation/Exploded View\"},{\"hook_visual_element_explanation\":\"Text overlay highlighting the problem and solution.\",\"hook_visual_element_name\":\"Text Overlay\"}]",
    "value_propositions": "[{\"value_proposition\":\"Hydrating\"},{\"value_proposition\":\"Peachy hues\"},{\"value_proposition\":\"Counteracts blue and purple hues\"},{\"value_proposition\":\"Doesn't crease\"},{\"value_proposition\":\"SPF 41\"},{\"value_proposition\":\"Easy application\"},{\"value_proposition\":\"Natural look\"}]",
    "concept_types": "[{\"concept_type_explanation\":\"The video demonstrates the product's application and highlights its benefits through a personal testimonial.\",\"concept_type_name\":\"Testimonial\"},{\"concept_type_explanation\":\"The content is a step-by-step guide on how to use the product to achieve a specific result.\",\"concept_type_name\":\"Tutorial\"}]",
    "hook_persona_attributes": "[\"Female\",\"Over 40\",\"Not a makeup expert\"]",
    "visual_elements": "[{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Product Application\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Before-and-After/Split-Screen\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Product in Use\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Testimonial/Talking Head\"}]"
  },
  {
    "account_name": "DRM2",
    "amount_spent": 59306.09,
    "ad_id": 120210493571650770,
    "persona_attributes": "[{\"persona_attribute\":\"Female\"},{\"persona_attribute\":\"Beauty Enthusiast\"},{\"persona_attribute\":\"Makeup User\"},{\"persona_attribute\":\"30-40 years old\"}]",
    "hook_types": "[{\"hook_type_explanation\":\"The countdown creates anticipation, and the phrase \\\"Here we go\\\" signals the start of a transformation.\",\"hook_type_name\":\"General Claim\"}]",
    "hook_visual_elements": "[{\"hook_visual_element_explanation\":\"The close-up shot focuses on the creator's face, highlighting the before-and-after transformation.\",\"hook_visual_element_name\":\"Close-Up/Detail\"},{\"hook_visual_element_explanation\":\"The application of the product is shown in detail, emphasizing the ease of use.\",\"hook_visual_element_name\":\"Product Application\"},{\"hook_visual_element_explanation\":\"The text overlay adds context and intrigue, suggesting a magical effect.\",\"hook_visual_element_name\":\"Text Overlay\"}]",
    "value_propositions": "[{\"value_proposition\":\"Easy application\"},{\"value_proposition\":\"Immediate results\"},{\"value_proposition\":\"Brightening effect\"},{\"value_proposition\":\"Magic-like transformation\"}]",
    "concept_types": "[{\"concept_type_explanation\":\"The video demonstrates the product's application and highlights its immediate effects, making it a tutorial.\",\"concept_type_name\":\"Tutorial\"},{\"concept_type_explanation\":\"The creator expresses amazement at the product's results, creating a sense of wonder and excitement.\",\"concept_type_name\":\"Testimonial\"}]",
    "hook_persona_attributes": "[\"Female\",\"Beauty Enthusiast\",\"Makeup User\"]",
    "visual_elements": "[{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Close-Up/Detail\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Before-and-After/Split-Screen\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Product Application\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Text Overlay\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Testimonial/Talking Head\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Lifestyle\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Text Overlay\"}]"
  },
  {
    "account_name": "DRM2",
    "amount_spent": 48128.26,
    "ad_id": 120211497786260770,
    "persona_attributes": "[{\"persona_attribute\":\"Female\"},{\"persona_attribute\":\"30-40 years old\"},{\"persona_attribute\":\"Makeup User\"},{\"persona_attribute\":\"Interested in anti-aging\"},{\"persona_attribute\":\"Seeks quick and easy solutions\"}]",
    "hook_types": "[{\"hook_type_explanation\":\"The video starts by addressing a common problem women face with makeup, making it relatable.\",\"hook_type_name\":\"Problem/Solution\"},{\"hook_type_explanation\":\"The phrase \\\"watch this\\\" creates intrigue and encourages viewers to continue watching.\",\"hook_type_name\":\"General Claim\"}]",
    "hook_visual_elements": "[{\"hook_visual_element_explanation\":\"An illustration shows how concealer can accentuate wrinkles around the eyes.\",\"hook_visual_element_name\":\"Before-and-After/Split-Screen\"},{\"hook_visual_element_explanation\":\"A hand applies concealer to the under-eye area.\",\"hook_visual_element_name\":\"Product Application\"},{\"hook_visual_element_explanation\":\"The text overlay creates a clear and concise message.\",\"hook_visual_element_name\":\"Text Overlay\"}]",
    "value_propositions": "[{\"value_proposition\":\"Easy application\"},{\"value_proposition\":\"Effective results\"},{\"value_proposition\":\"Anti-aging benefits\"},{\"value_proposition\":\"Magic-like transformation\"}]",
    "concept_types": "[{\"concept_type_explanation\":\"The video demonstrates the product's application and immediate results, making it a tutorial.\",\"concept_type_name\":\"Tutorial\"},{\"concept_type_explanation\":\"A woman shares her experience with the product, expressing surprise and delight at its effectiveness.\",\"concept_type_name\":\"Testimonial\"}]",
    "hook_persona_attributes": "[\"Female\",\"Makeup User\",\"Interested in anti-aging\"]",
    "visual_elements": "[{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Testimonial/Talking Head\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Close-Up/Detail\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Text Overlay\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Before-and-After/Split-Screen\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Product Application\"}]"
  },
  {
    "account_name": "DRM2",
    "amount_spent": 192622.06,
    "ad_id": 120212432262770770,
    "persona_attributes": "[{\"persona_attribute\":\"Female\"},{\"persona_attribute\":\"Makeup Enthusiast\"},{\"persona_attribute\":\"Mid-40s\"}]",
    "hook_types": "[{\"confidence_score\":85,\"hook_type_explanation\":\"The influencer starts by acknowledging the unusual context, creating intrigue and drawing the viewer in.\",\"hook_type_name\":\"General Claim\"},{\"confidence_score\":75,\"hook_type_explanation\":\"The large number of followers and the influencer's statement about sharing a product create a sense of anticipation and importance.\",\"hook_type_name\":\"Social Proof\"}]",
    "hook_visual_elements": "[{\"hook_visual_element_explanation\":\"The influencer is shown in a close-up shot, creating a personal connection with the viewer.\",\"hook_visual_element_name\":\"Talking Head\"},{\"hook_visual_element_explanation\":\"The text overlay \\\"Mind blown\\\" immediately grabs attention and hints at a surprising product reveal.\",\"hook_visual_element_name\":\"Text Overlay\"}]",
    "value_propositions": "[{\"value_proposition\":\"Effective at concealing dark circles\"},{\"value_proposition\":\"Easy application\"},{\"value_proposition\":\"Cooling wand\"},{\"value_proposition\":\"Medical grade\"}]",
    "concept_types": "[{\"concept_type_explanation\":\"The video features a woman sharing her personal experience with the product, demonstrating its application and highlighting its benefits.\",\"concept_type_name\":\"Testimonial\",\"confidence_score\":95},{\"concept_type_explanation\":\"The video shows a before-and-after comparison of the influencer's under-eye area, clearly demonstrating the product's effectiveness.\",\"concept_type_name\":\"Before-and-After\",\"confidence_score\":90}]",
    "hook_persona_attributes": "[\"Female\",\"Makeup Enthusiast\",\"Mid-40s\"]",
    "visual_elements": "[{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Talking Head\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Close-Up/Detail\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Before-and-After/Split-Screen\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Product in Use\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Product Application\"}]"
  },
  {
    "account_name": "DRM2",
    "amount_spent": 40346.68,
    "ad_id": 120211217795950770,
    "persona_attributes": "[{\"persona_attribute\":\"Female\"},{\"persona_attribute\":\"Beauty Influencer\"},{\"persona_attribute\":\"Makeup User\"},{\"persona_attribute\":\"Skincare Enthusiast\"}]",
    "hook_types": "[{\"hook_type_explanation\":\"The hook uses a trending topic on TikTok to grab attention.\",\"hook_type_name\":\"Appeal To Trend\"},{\"hook_type_explanation\":\"The hook highlights a common problem with concealers.\",\"hook_type_name\":\"Problem/Solution\"}]",
    "hook_visual_elements": "[{\"hook_visual_element_explanation\":\"The content creator is shown applying makeup, demonstrating the product in use.\",\"hook_visual_element_name\":\"Product Application\"},{\"hook_visual_element_explanation\":\"On-screen text introduces the topic and product.\",\"hook_visual_element_name\":\"Text Overlay\"},{\"hook_visual_element_explanation\":\"The video shows the content creator's face, making it relatable.\",\"hook_visual_element_name\":\"Testimonial/Talking Head\"}]",
    "value_propositions": "[{\"value_proposition\":\"Lightweight\"},{\"value_proposition\":\"Hydrating\"},{\"value_proposition\":\"SPF 41\"},{\"value_proposition\":\"Peachy hues\"},{\"value_proposition\":\"Counteracts dark circles\"},{\"value_proposition\":\"No caking\"},{\"value_proposition\":\"No creasing\"},{\"value_proposition\":\"All-day wear\"}]",
    "concept_types": "[{\"concept_type_explanation\":\"The video presents a problem (caking and creasing concealer) and offers a solution (eye corrector).\",\"concept_type_name\":\"Problem/Solution\"},{\"concept_type_explanation\":\"The content is a tutorial demonstrating how to use an eye corrector.\",\"concept_type_name\":\"Tutorial\"},{\"concept_type_explanation\":\"The video includes a testimonial from the content creator about the product.\",\"concept_type_name\":\"Testimonial\"}]",
    "hook_persona_attributes": "[\"Makeup User\",\"TikTok User\",\"Beauty Enthusiast\"]",
    "visual_elements": "[{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Product Application\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Unboxing\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Before-and-After/Split-Screen\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Close-Up/Detail\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Text Overlay\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Testimonial/Talking Head\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Lifestyle\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_type\":\"Mirror Reflection\"}]"
  },
  {
    "account_name": "DRM2",
    "amount_spent": 56472.82,
    "ad_id": 120210493383690770,
    "persona_attributes": "[{\"persona_attribute\":\"Older woman\"},{\"persona_attribute\":\"Not a makeup expert\"}]",
    "hook_types": "[{\"confidence_score\":90,\"hook_type_explanation\":\"The video starts by highlighting a common problem women face with concealer making their eyes look older, then introduces the product as a solution.\",\"hook_type_name\":\"Problem/Solution\"},{\"confidence_score\":85,\"hook_type_explanation\":\"The video directly addresses a specific persona, older women who are not makeup experts.\",\"hook_type_name\":\"Appeal To Persona\"}]",
    "hook_visual_elements": "[{\"hook_visual_element_explanation\":\"The video starts with an animation showing how concealer can make eyes look older.\",\"hook_visual_element_name\":\"3D Animation/Exploded View\"},{\"hook_visual_element_explanation\":\"The video shows a woman applying the product.\",\"hook_visual_element_name\":\"Application/Usage\"},{\"hook_visual_element_explanation\":\"The video shows a close-up of the woman's face.\",\"hook_visual_element_name\":\"Close-Up/Detail\"}]",
    "value_propositions": "[{\"value_proposition\":\"Hydrating\"},{\"value_proposition\":\"Peachy hues\"},{\"value_proposition\":\"Counteracts blue and purple hues\"},{\"value_proposition\":\"Does not get caught in creases\"},{\"value_proposition\":\"SPF 41\"},{\"value_proposition\":\"Super hydrating\"},{\"value_proposition\":\"Good for eyelids\"}]",
    "concept_types": "[{\"concept_type_explanation\":\"The video features a woman sharing her personal experience with the product, highlighting its benefits and ease of use.\",\"concept_type_name\":\"Testimonial\",\"confidence_score\":95},{\"concept_type_explanation\":\"The video provides a step-by-step demonstration of how to apply the eye corrector.\",\"concept_type_name\":\"Tutorial\",\"confidence_score\":80}]",
    "hook_persona_attributes": "[\"Not a makeup girly\",\"Older woman\"]",
    "visual_elements": "[{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"3D Animation/Exploded View\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Application/Usage\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Before-and-After/Split-Screen\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Close-Up/Detail\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Product Application\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Talking Head\"}]"
  },
  {
    "account_name": "DRM2",
    "amount_spent": 37224.94,
    "ad_id": 120212105530990770,
    "persona_attributes": "[{\"persona_attribute\":\"Female\"},{\"persona_attribute\":\"Over 40\"},{\"persona_attribute\":\"Not a makeup expert\"}]",
    "hook_types": "[{\"confidence_score\":90,\"hook_type_explanation\":\"The video starts by highlighting a common problem faced by women over 40 who use concealer.\",\"hook_type_name\":\"Problem/Solution\"},{\"confidence_score\":80,\"hook_type_explanation\":\"The video targets a specific demographic of women over 40 who are concerned about their appearance.\",\"hook_type_name\":\"Appeal To Persona\"}]",
    "hook_visual_elements": "[{\"hook_visual_element_explanation\":\"The video uses an illustration to show the problem of concealer making eyes look older.\",\"hook_visual_element_name\":\"Before-and-After/Split-Screen\"},{\"hook_visual_element_explanation\":\"The video shows a close-up of the product being applied.\",\"hook_visual_element_name\":\"Product Application\"}]",
    "value_propositions": "[{\"value_proposition\":\"Hydrating\"},{\"value_proposition\":\"Peachy hues\"},{\"value_proposition\":\"Does not crease\"},{\"value_proposition\":\"SPF 41\"},{\"value_proposition\":\"Easy application\"}]",
    "concept_types": "[{\"concept_type_explanation\":\"The video demonstrates the product's application and highlights its benefits through a before-and-after comparison.\",\"concept_type_name\":\"Before-and-After\",\"confidence_score\":95},{\"concept_type_explanation\":\"The video presents a personal testimonial from a user who shares their experience with the product.\",\"concept_type_name\":\"Testimonial\",\"confidence_score\":90},{\"concept_type_explanation\":\"The video provides a step-by-step guide on how to use the eye corrector.\",\"concept_type_name\":\"Tutorial\",\"confidence_score\":85}]",
    "hook_persona_attributes": "[\"Female\",\"Over 40\",\"Not a makeup expert\"]",
    "visual_elements": "[{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Before-and-After/Split-Screen\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Product Application\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Close-Up/Detail\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Product in Use\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"3D Animation/Exploded View\"}]"
  },
  {
    "account_name": "DRM2",
    "amount_spent": 38427.67,
    "ad_id": 120212272769060770,
    "persona_attributes": "[{\"persona_attribute\":\"Busy\"},{\"persona_attribute\":\"Makeup User\"},{\"persona_attribute\":\"Time-Conscious\"}]",
    "hook_types": "[{\"confidence_score\":90,\"hook_type_explanation\":\"The video starts with a countdown, creating anticipation and excitement.\",\"hook_type_name\":\"General Claim\"},{\"confidence_score\":80,\"hook_type_explanation\":\"The video directly addresses a user's comment about being too lazy for concealer.\",\"hook_type_name\":\"Problem/Solution\"}]",
    "hook_visual_elements": "[{\"hook_visual_element_explanation\":\"The initial shot shows a product box being opened, creating intrigue.\",\"hook_visual_element_name\":\"Unboxing\"},{\"hook_visual_element_explanation\":\"The video shows a user comment, creating a relatable context.\",\"hook_visual_element_name\":\"Social Media UI\"}]",
    "value_propositions": "[{\"value_proposition\":\"Easy Application\"},{\"value_proposition\":\"Effective\"},{\"value_proposition\":\"Time-Saving\"}]",
    "concept_types": "[{\"concept_type_explanation\":\"The video directly responds to a user's comment, addressing a specific problem and offering a solution.\",\"concept_type_name\":\"Q&A\",\"confidence_score\":95},{\"concept_type_explanation\":\"The video demonstrates the product's application and immediate results, making it a visual tutorial.\",\"concept_type_name\":\"Tutorial\",\"confidence_score\":85},{\"concept_type_explanation\":\"The presenter's enthusiastic tone and expressions convey their genuine excitement about the product.\",\"concept_type_name\":\"Testimonial\",\"confidence_score\":75}]",
    "hook_persona_attributes": "[\"Lazy\",\"Makeup User\"]",
    "visual_elements": "[{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Social Media UI\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Unboxing\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Product Application\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Action/Motion\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Before-and-After/Split-Screen\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Text Overlay\"}]"
  },
  {
    "account_name": "DRM2",
    "amount_spent": 85719.08,
    "ad_id": 120212272769040770,
    "persona_attributes": "[{\"persona_attribute\":\"Lazy\"},{\"persona_attribute\":\"Time-constrained\"},{\"persona_attribute\":\"Makeup-inexperienced\"},{\"persona_attribute\":\"Seeks quick solutions\"}]",
    "hook_types": "[{\"confidence_score\":90,\"hook_type_explanation\":\"The video starts by addressing a viewer's problem with dark circles, immediately presenting the product as a solution.\",\"hook_type_name\":\"Problem/Solution\"},{\"confidence_score\":80,\"hook_type_explanation\":\"The video targets a specific persona of lazy individuals who don't wear makeup but want to address dark circles.\",\"hook_type_name\":\"Appeal To Persona\"}]",
    "hook_visual_elements": "[{\"hook_visual_element_explanation\":\"The video opens with a text overlay showing a viewer's comment about dark circles, setting the stage for the product demonstration.\",\"hook_visual_element_name\":\"Social Media UI\"},{\"hook_visual_element_explanation\":\"The product is shown in its packaging, creating anticipation for the demonstration.\",\"hook_visual_element_name\":\"Unboxing\"},{\"hook_visual_element_explanation\":\"The product is shown being applied to the eye area, demonstrating its use.\",\"hook_visual_element_name\":\"Product Application\"}]",
    "value_propositions": "[{\"value_proposition\":\"Easy application\"},{\"value_proposition\":\"Effective results\"},{\"value_proposition\":\"Minimal makeup required\"}]",
    "concept_types": "[{\"concept_type_explanation\":\"The video directly addresses a viewer's question about dark circles, providing a solution in the form of a product demonstration.\",\"concept_type_name\":\"Q&A\",\"confidence_score\":95},{\"concept_type_explanation\":\"The video uses a fast-paced, energetic style with quick cuts and enthusiastic commentary to generate excitement and interest in the product.\",\"concept_type_name\":\"Hype Reel\",\"confidence_score\":85},{\"concept_type_explanation\":\"The video demonstrates the product's application and immediate results, highlighting its ease of use and effectiveness.\",\"concept_type_name\":\"Tutorial\",\"confidence_score\":80}]",
    "hook_persona_attributes": "[\"Lazy\",\"Makeup-inexperienced\",\"Seeks quick solutions\"]",
    "visual_elements": "[{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Social Media UI\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Unboxing\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Product Application\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Before-and-After/Split-Screen\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Close-Up/Detail\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Action/Motion\"}]"
  },
  {
    "account_name": "DRM2",
    "amount_spent": 52873.07,
    "ad_id": 120212514629030770,
    "persona_attributes": "[{\"persona_attribute\":\"Busy Mother\"},{\"persona_attribute\":\"Hungover\"},{\"persona_attribute\":\"Makeup User\"}]",
    "hook_types": "[{\"confidence_score\":90,\"hook_type_explanation\":\"The video starts by addressing a viewer's comment expressing a common problem (laziness to use concealer) and then presents the product as a solution.\",\"hook_type_name\":\"Problem/Solution\"}]",
    "hook_visual_elements": "[{\"hook_visual_element_explanation\":\"The video opens with a text overlay showing a comment from a user asking for a solution to under-eye issues.\",\"hook_visual_element_name\":\"Social Media UI\"},{\"hook_visual_element_explanation\":\"The product is shown in its packaging, creating anticipation and intrigue.\",\"hook_visual_element_name\":\"Unboxing\"},{\"hook_visual_element_explanation\":\"The product is shown being applied, highlighting its ease of use.\",\"hook_visual_element_name\":\"Product Application\"}]",
    "value_propositions": "[{\"value_proposition\":\"Easy Application\"},{\"value_proposition\":\"Peachy Orange Color\"},{\"value_proposition\":\"Counteracts Dark Circles\"},{\"value_proposition\":\"SPF 41\"},{\"value_proposition\":\"No Creasing\"}]",
    "concept_types": "[{\"concept_type_explanation\":\"The video directly addresses a viewer's question about eye makeup, providing a tutorial-style demonstration and explanation of the product's use.\",\"concept_type_name\":\"Tutorial\",\"confidence_score\":95},{\"concept_type_explanation\":\"The content focuses on the product's features and benefits, explaining how it solves a specific problem for the target audience.\",\"concept_type_name\":\"Product Demonstration\",\"confidence_score\":90},{\"concept_type_explanation\":\"The presenter shares their personal experience using the product, highlighting its ease of use and effectiveness.\",\"concept_type_name\":\"Testimonial\",\"confidence_score\":85}]",
    "hook_persona_attributes": "[\"Busy Mom\",\"Hungover\"]",
    "visual_elements": "[{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Social Media UI\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Unboxing\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Close-Up/Detail\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Product Application\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Before-and-After/Split-Screen\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Talking Head\"}]"
  },
  {
    "account_name": "DRM2",
    "amount_spent": 37030.66,
    "ad_id": 120212611189740770,
    "persona_attributes": "[{\"persona_attribute\":\"Busy professional\"},{\"persona_attribute\":\"Skincare enthusiast\"}]",
    "hook_types": "[{\"confidence_score\":85,\"hook_type_explanation\":\"The video starts by addressing a common problem faced by many women who work from home and are looking for a quick and easy way to look put together without wearing full makeup.\",\"hook_type_name\":\"Problem/Solution\"}]",
    "hook_visual_elements": "[{\"hook_visual_element_explanation\":\"A woman's face appears in a comment box, expressing a common problem of being too lazy to wear makeup daily.\",\"hook_visual_element_name\":\"Text Message\"},{\"hook_visual_element_explanation\":\"The product is shown in the hand of a woman, creating a visual connection between the problem and the solution.\",\"hook_visual_element_name\":\"Product in Use\"}]",
    "value_propositions": "[{\"value_proposition\":\"Moisturizer\"},{\"value_proposition\":\"Sheer coverage\"},{\"value_proposition\":\"Sunscreen\"},{\"value_proposition\":\"Blurs pores\"},{\"value_proposition\":\"Sunkissed glow\"},{\"value_proposition\":\"Lightweight feel\"},{\"value_proposition\":\"Universal shade\"},{\"value_proposition\":\"Hyaluronic acid\"},{\"value_proposition\":\"Niacinamide\"},{\"value_proposition\":\"Vitamin E\"},{\"value_proposition\":\"Hydration\"},{\"value_proposition\":\"Anti-aging benefits\"},{\"value_proposition\":\"Weightless SPF\"},{\"value_proposition\":\"No white cast\"},{\"value_proposition\":\"Large bottle\"},{\"value_proposition\":\"Affordable price\"}]",
    "concept_types": "[{\"concept_type_explanation\":\"The video features a woman sharing her personal experience with the product, highlighting its benefits and ease of use.\",\"concept_type_name\":\"Testimonial\",\"confidence_score\":95}]",
    "hook_persona_attributes": "[\"Busy professional\",\"Skincare enthusiast\"]",
    "visual_elements": "[{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Product in Use\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Product Application\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Before-and-After/Split-Screen\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Unboxing\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Social Media UI\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Text Overlay\"},{\"visual_element_explanation\":\"Default explanation\",\"visual_element_name\":\"Talking Head\"}]"
  }
]

import json
import psycopg2
import os
from dotenv import load_dotenv
from collections import defaultdict
from decimal import Decimal  # Add this import

# Database connection function
def get_db_connection():
    try:
        conn = psycopg2.connect(
            dbname=os.getenv('DB_NAME'),
            user=os.getenv('DB_USER'),
            password=os.getenv('DB_PASSWORD'),
            host= os.getenv('DB_HOST'),
            port="5432",
            sslmode="require",
            sslrootcert=os.getenv('SECRET_KEY')
        )
        return conn
    except Exception as e:
        print("Error connecting to the database:", e)
        return None

# Fetch data from database
def fetch_ad_data():
    conn = get_db_connection()
    if conn is None:
        return []
    
    query_spend = """
    SELECT a.account_name, a.ad_id, a.amount_spent, 
           b.visual_elements, b.concept_types, b.value_propositions, 
           b.persona_attributes, b.hook_visual_elements, b.hook_types, b.hook_persona_attributes 
    FROM ad_insights AS a 
    JOIN ad_creative_analysis AS b ON a.ad_id = b.ad_id 
    WHERE account_name ILIKE '%drm%' AND amount_spent >= 35000
    """
    
    query_thumbstop = """
    SELECT a.account_name, a.ad_id, a.thumbstop, b.hook_audio_transcript_text, b.hook_visual_transcript_text, b.hook_visual_elements, b.hook_types, b.hook_persona_attributes 
    FROM ad_insights AS a JOIN ad_creative_analysis AS b ON a.ad_id = b.ad_id 
    WHERE account_name ILIKE '%drm%' AND thumbstop >= 0.515
    """

    query = query_spend

    try:
        with conn.cursor() as cursor:
            cursor.execute(query)
            columns = [desc[0] for desc in cursor.description]
            results = [dict(zip(columns, row)) for row in cursor.fetchall()]
        conn.close()
        return results
    except Exception as e:
        print("Error executing query:", e)
        conn.close()
        return []

# Helper function to convert Decimal to float
def convert_decimal(data):
    if isinstance(data, list):
        return [convert_decimal(item) for item in data]
    elif isinstance(data, dict):
        return {key: convert_decimal(value) for key, value in data.items()}
    elif isinstance(data, Decimal):
        return float(data)  # or str(data) if precision needs to be retained as string
    else:
        return data

# Process data
data = fetch_ad_data()
data = convert_decimal(data)  # Convert all Decimal instances
print("Data: ", data[:1])

# Initialize counters and storage structures
total_ads = len(data)
unique_ad_ids = set()

# Configuration for each dimension (dimension name, key in nested JSON)
dimension_configs = [
    ("concept_types", "concept_type_name"),
    ("persona_attributes", "persona_attribute"),
    ("visual_elements", "visual_element_type"),
    ("value_propositions", "value_proposition"),
    ("hook_types", "hook_type_name"),
    ("hook_visual_elements", "hook_visual_element_name"),
    ("hook_persona_attributes", "hook_persona_attribute"),  # List of strings,
    ("hook_audio_transcript_text", "hook_audio_transcript_text"),
    ("hook_visual_transcript_text", "hook_visual_transcript_text")
]


# Dictionary to hold all dimensions
dimensions = {name: defaultdict(lambda: {
    "total_ads": 0, 
    "ad_ids": set(), 
    #"amount_spent": 0
    "amount_spent_total": 0,
    "thumbstop_total": 0,
    "amount_spent_count": 0,
    "thumbstop_count": 0
    }) for name, _ in dimension_configs}

# Parse through the data
for ad in data:
    ad_id = ad["ad_id"]
    amount_spent = ad.get("amount_spent")
    thumbstop = ad.get("thumbstop")
    unique_ad_ids.add(ad_id)

    # Extract and count each dimension type based on configurations
    for dimension_name, item_key in dimension_configs:
        if dimension_name in ad and ad[dimension_name]:  # Ensure dimension data is not None
            try:
                # items = json.loads(ad[dimension_name])  # Convert string to JSON if using example like sample above
                items = ad[dimension_name]  # Directly use the data without json.loads()

                if isinstance(items, list) and isinstance(items[0], dict):
                    for item in items:
                        item_name = item.get(item_key)  # Retrieve specific key for each dimension
                        if item_name:
                            dimensions[dimension_name][item_name]["total_ads"] += 1
                            dimensions[dimension_name][item_name]["ad_ids"].add(ad_id)
                            # Only add if amount_spent is present
                            if amount_spent is not None:
                                dimensions[dimension_name][item_name]["amount_spent_total"] += amount_spent
                                dimensions[dimension_name][item_name]["amount_spent_count"] += 1
                            
                            # Only add if thumbstop is present
                            if thumbstop is not None:
                                dimensions[dimension_name][item_name]["thumbstop_total"] += thumbstop
                                dimensions[dimension_name][item_name]["thumbstop_count"] += 1
                elif isinstance(items, list) and isinstance(items[0], str):  # For list of strings
                    for item_name in items:
                        dimensions[dimension_name][item_name]["total_ads"] += 1
                        dimensions[dimension_name][item_name]["ad_ids"].add(ad_id)
                        # Only add if amount_spent is present
                        if amount_spent is not None:
                            dimensions[dimension_name][item_name]["amount_spent_total"] += amount_spent
                            dimensions[dimension_name][item_name]["amount_spent_count"] += 1
                        
                        # Only add if thumbstop is present
                        if thumbstop is not None:
                            dimensions[dimension_name][item_name]["thumbstop_total"] += thumbstop
                            dimensions[dimension_name][item_name]["thumbstop_count"] += 1
                # Handling text fields (e.g., hook_audio_transcript_text, hook_visual_transcript_text)
                elif isinstance(items, str):
                    dimensions[dimension_name][items]["total_ads"] += 1
                    dimensions[dimension_name][items]["ad_ids"].add(ad_id)
                    
                    # Only add if amount_spent is present
                    if amount_spent is not None:
                        dimensions[dimension_name][items]["amount_spent_total"] += amount_spent
                        dimensions[dimension_name][items]["amount_spent_count"] += 1
                    
                    # Only add if thumbstop is present
                    if thumbstop is not None:
                        dimensions[dimension_name][items]["thumbstop_total"] += thumbstop
                        dimensions[dimension_name][items]["thumbstop_count"] += 1
              
            except json.JSONDecodeError:
                pass

# Prepare final output
output = {
    "total_ads": total_ads,
    "total_ad_ids": len(unique_ad_ids)
}

# Construct each dimension's output based on configurations, including the total count of unique items
for dimension_name, item_key in dimension_configs:
    unique_items = [
        {
            item_key: name,
            "total_ads": info["total_ads"],
            "ad_ids": list(info["ad_ids"]),
            "average_amount_spent": (info["amount_spent_total"] / info["amount_spent_count"]) if info["amount_spent_count"] > 0 else None,
            "average_thumbstop": (info["thumbstop_total"] / info["thumbstop_count"]) if info["thumbstop_count"] > 0 else None
        }
        for name, info in dimensions[dimension_name].items()
    ]
    # Sort by "average_amount_spent" if exists, then by "average_thumbstop" if exists, then by "total_ads"
    unique_items = sorted(
        unique_items, 
        key=lambda x: (x["average_amount_spent"] or 0, x["average_thumbstop"] or 0, x["total_ads"]),
        reverse=True
    )[:5]
    
    output[dimension_name] = {
        "total_unique": len(dimensions[dimension_name]),  # Total unique items in this dimension
        "items": unique_items
    }

# Print the final JSON output
print(json.dumps(output, indent=2))